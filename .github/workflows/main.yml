name: Build Fox RP Safe
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Fox RP Branding
        run: |
          # Меняем название во всех strings.xml
          find . -name "strings.xml" -exec sed -i 's/OpenSAMP/Fox RP/g' {} +
          
          # Настраиваем оранжевый цвет более надежным способом
          find . -name "colors.xml" -exec sed -i 's/<color name="colorPrimary">.*<\/color>/<color name="colorPrimary">#FF8C00<\/color>/g' {} +

          # Пытаемся заменить ссылку на Pastebin (используем более гибкий поиск)
          grep -rl "https://raw.githubusercontent.com" . | xargs sed -i 's|https://raw.githubusercontent.com/.*/servers.json|https://pastebin.com/raw/rSHgfpgz|g' || true

      - name: Build APK
        run: |
          chmod +x gradlew
          ./gradlew assembleDebug --stacktrace

      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: Fox-RP-Safe-Build
          path: app/build/outputs/apk/debug/*.apk
          
